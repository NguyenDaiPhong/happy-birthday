<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Happy Birthday</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: black;
      
      /* === TH√äM L·∫†I: S·ª¨A FONT === */
      font-family: 'Patrick Hand', 'Comic Sans MS', cursive;
    }
    canvas {
      display: block;
    }
    .message {
      position: absolute;
      bottom: 60px;
      width: 100%;
      text-align: center;
      font-size: 42px;
      color: gold;
      text-shadow: 2px 2px 5px #000;
      z-index: 2;
    }
    .popup {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff5f8; /* N·ªÅn h·ªìng r·∫•t nh·∫°t */
      padding: 30px;
      border-radius: 15px; /* Bo tr√≤n nhi·ªÅu h∆°n */
      font-size: 24px;
      color: #c9003b; /* M√†u ƒë·ªè h·ªìng s·∫≠m, d·ªÖ ƒë·ªçc h∆°n */
      font-weight: bold; /* In ƒë·∫≠m ch·ªØ */
      box-shadow: 0 0 25px #ffadc0; /* B√≥ng m·ªù m√†u h·ªìng */
      border: 2px solid #ffadc0; /* Th√™m vi·ªÅn h·ªìng */
      display: none;
      z-index: 3;
    }

    /* === CSS CHO VIDEO === */
    .video-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
      display: none;
      z-index: 4; /* Hi·ªÉn th·ªã tr√™n c√πng */
      text-align: center;
    }
    video {
      max-width: 100%;
      max-height: 80vh; /* Gi·ªõi h·∫°n chi·ªÅu cao video */
    }
  </style>
</head>
<body>
<canvas id="canvas"></canvas>
<div class="message">üéÇ Happy Birthday Tiu Tiu üéâ</div>
<div class="popup" id="popup">üíñ Ch√∫c Tiu Tiu sinh nh·∫≠t vui v·∫ª, tu·ªïi m·ªõi th√™m nhi·ªÅu ni·ªÅm vui m·ªõi, c·∫ßu g√¨ ƒë∆∞·ª£c n·∫•y, c·∫ßu ti·ªÅn ƒë∆∞·ª£c ti·ªÅn, c·∫ßu t√¨nh ƒë∆∞·ª£c t√¨nh, c·∫ßu t√†i ƒë∆∞·ª£c t√†i nhoazzz! üíñ</div>

<div class="video-container" id="video-container">
  <video id="birthdayVideo" width="80%" controls>
    <source src="hpbd.mp4" type="video/mp4">
    Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ video.
  </video>
</div>
<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;
let time = 0;
let clickState = 0; 

const cake = {
  x: W / 2,
  y: H / 2 + 30,
  width: 340,
  height: 60,
  tiers: 3
};

const candles = [
  { offset: -70, flame: true },
  { offset: 0, flame: true },
  { offset: 70, flame: true }
];

const confetti = [];
const balloons = [];

const popup = document.getElementById("popup");
const videoContainer = document.getElementById("video-container");
const video = document.getElementById("birthdayVideo");


/* === C√ÅC H√ÄM V·∫º (GI·ªÆ NGUY√äN) === */
function drawCake() {
  const tierHeight = cake.height;
  const tierGap = 15;
  for (let i = 0; i < cake.tiers; i++) {
    const tierWidth = cake.width - i * 60;
    const x = cake.x - tierWidth / 2;
    const y = cake.y - i * (tierHeight + tierGap);
    ctx.beginPath();
    ctx.fillStyle = "#87CEFA";
    ctx.fillRect(x, y, tierWidth, tierHeight);
    ctx.strokeStyle = "white";
    ctx.lineWidth = 3;
    ctx.strokeRect(x, y, tierWidth, tierHeight);
    for (let j = 10; j < tierWidth - 10; j += 20) {
      ctx.beginPath();
      ctx.fillStyle = "white";
      ctx.arc(x + j, y + 10, 4, 0, Math.PI * 2);
      ctx.fill();
    }
  }
}
function drawCandles() {
  const tierHeight = cake.height;
  const topY = cake.y - cake.tiers * (tierHeight + 15) + 10;
  candles.forEach(c => {
    const cx = cake.x + c.offset;
    const cy = topY - 20;
    ctx.fillStyle = "pink";
    ctx.fillRect(cx - 6, cy + 20, 12, 50);
if (c.flame) {
  const flameHeight = 20;
  const flameWidth = 12;
  const offset = Math.sin(time / 20 + c.offset) * 2;
  ctx.beginPath();
  ctx.moveTo(cx, cy - flameHeight + offset); 
  ctx.bezierCurveTo(
    cx + flameWidth, cy - flameHeight / 2 + offset,
    cx + flameWidth / 2, cy + 10 + offset,
    cx, cy + 10 + offset
  );
  ctx.bezierCurveTo(
    cx - flameWidth / 2, cy + 10 + offset,
    cx - flameWidth, cy - flameHeight / 2 + offset,
    cx, cy - flameHeight + offset
  );
  ctx.fillStyle = "gold";
  ctx.fill();
}
  });
}
function drawConfetti() {
  if (confetti.length < 60) {
    confetti.push({
      x: Math.random() * W,
      y: Math.random() * H,
      color: `hsl(${Math.random() * 360}, 100%, 50%)`,
      size: 5 + Math.random() * 3,
      speed: 1 + Math.random() * 2
    });
  }
  for (let i = 0; i < confetti.length; i++) {
    const c = confetti[i];
    ctx.fillStyle = c.color;
    ctx.fillRect(c.x, c.y, c.size, c.size);
    c.y += c.speed;
    if (c.y > H) {
      c.y = -10;
      c.x = Math.random() * W;
    }
  }
}
function drawBalloons() {
  if (balloons.length < 6) {
    balloons.push({
      x: Math.random() * W,
      y: H + Math.random() * 100,
      color: `hsl(${Math.random() * 360}, 70%, 60%)`,
      radius: 25 + Math.random() * 10,
      speed: 1 + Math.random()
    });
  }
  for (let i = 0; i < balloons.length; i++) {
    const b = balloons[i];
    ctx.beginPath();
    ctx.fillStyle = b.color;
    ctx.ellipse(b.x, b.y, b.radius, b.radius * 1.3, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.moveTo(b.x, b.y + b.radius * 1.3);
    ctx.lineTo(b.x, b.y + b.radius * 1.3 + 20);
    ctx.strokeStyle = "white";
    ctx.stroke();
    b.y -= b.speed;
    if (b.y < -50) {
      b.y = H + Math.random() * 100;
      b.x = Math.random() * W;
    }
  }
}
/* === K·∫æT TH√öC H√ÄM V·∫º === */


/* === S·ª¨A: LOGIC CLICK (Th√™m 'touchstart' cho ƒëi·ªán tho·∫°i) === */
// T·∫°o m·ªôt h√†m chung ƒë·ªÉ x·ª≠ l√Ω c·∫£ click v√† ch·∫°m
function handleInteraction(event) {
  // NgƒÉn ch·∫∑n c√°c h√†nh vi m·∫∑c ƒë·ªãnh (nh∆∞ zoom, cu·ªôn, ho·∫∑c "ghost click")
  event.preventDefault(); 
  
  // N·∫øu click v√†o video (v√≠ d·ª•: n√∫t play/pause) ho·∫∑c popup, th√¨ kh√¥ng l√†m g√¨
  if (videoContainer.contains(event.target) || popup.contains(event.target)) {
    return;
  }

  if (clickState === 0) {
    // CLICK 1: T·∫Øt n·∫øn, hi·ªán video
    candles.forEach(c => c.flame = false);
    videoContainer.style.display = "block";
    
    // C·∫¢NH B√ÅO: L·ªánh .play() n√†y c√≥ th·ªÉ B·ªä CH·∫∂N b·ªüi iPhone!
    video.play(); 
    
    clickState = 1; // Chuy·ªÉn tr·∫°ng th√°i

  } else if (clickState === 1) {
    // CLICK 2: ·∫®n video, hi·ªán popup
    video.pause(); // D·ª´ng video
    videoContainer.style.display = "none";
    popup.style.display = "block";
    clickState = 2; // Chuy·ªÉn tr·∫°ng th√°i
    
    // G·ª° b·ªè c√°c listener sau khi ƒë√£ xong
    window.removeEventListener("click", handleInteraction);
    window.removeEventListener("touchstart", handleInteraction);
  }
}

// Th√™m c·∫£ hai s·ª± ki·ªán ƒë·ªÉ g·ªçi chung 1 h√†m
window.addEventListener("click", handleInteraction);
window.addEventListener("touchstart", handleInteraction);
/* === K·∫æT TH√öC S·ª¨A === */


function loop() {
  time++;
  ctx.clearRect(0, 0, W, H);
  drawConfetti();
  drawBalloons();
  drawCake();
  drawCandles();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
